<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>링크 페이지</title>
    <link rel="stylesheet" href="color-tokens.css">
    <link rel="stylesheet" href="typography-tokens.css">
    <link rel="stylesheet" href="radius-tokens.css">
    <link rel="stylesheet" href="spacing-tokens.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="link-page">
    <!-- Layout -->
    <div class="layout">
        <!-- Header (모바일에서만 표시) -->
        <header class="mobile-header">
            <div class="header-content">
                <img src="resource/logo-inpock.png" alt="인포크 로고">
            </div>
        </header>

        <!-- Container -->
        <div class="container">
            <!-- Sidebar (PC에서만 표시) -->
            <aside class="sidebar">
                <div class="logo">
                    <img src="resource/logo-inpock.png" alt="인포크 로고">
                </div>
                
                <!-- Sidebar Content -->
                <div class="sidebar-content">
                    <!-- Navigation -->
                    <nav class="navigation">
                        <a href="link-page.html" class="nav-item active" onclick="window.location.href='link-page.html'; return false;">
                            <div class="nav-icon">
                                <img src="icon/icon-gnb-link-active.svg" alt="링크" width="24" height="24">
                            </div>
                            <span>링크</span>
                        </a>
                        <a href="#" class="nav-item">
                            <div class="nav-icon">
                                <img src="icon/icon-gnb-manager.svg" alt="매니저" width="24" height="24">
                            </div>
                            <span>매니저</span>
                        </a>
                        <a href="#" class="nav-item">
                            <div class="nav-icon">
                                <img src="icon/icon-gnb-deal.svg" alt="딜" width="24" height="24">
                            </div>
                            <span>딜</span>
                        </a>
                        <a href="#" class="nav-item">
                            <div class="nav-icon">
                                <img src="icon/icon-gnb-chat.svg" alt="채팅" width="24" height="24">
                            </div>
                            <span>채팅</span>
                            <div class="badge">9</div>
                        </a>
                        <a href="#" class="nav-item">
                            <div class="nav-icon">
                                <img src="icon/icon-gnb-all.svg" alt="전체" width="24" height="24">
                            </div>
                            <span>전체</span>
                        </a>
                    </nav>

                    <!-- Cards -->
                    <div class="cards" onclick="window.location.href='index.html'; return false;" style="cursor: pointer;">
                        <div class="card">
                            <div class="card-header">
                                <h3>방문자</h3>
                                <img src="icon/icon-arrowright.svg" alt="화살표" width="16" height="16">
                            </div>
                            <div class="card-content">
                                <div class="stat-row">
                                    <span class="stat-label">전체</span>
                                    <span class="stat-value">123만 4567</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">오늘</span>
                                    <span class="stat-value">9,876</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">실시간</span>
                                    <span class="stat-value">1</span>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>소식받기</h3>
                                <img src="icon/icon-arrowright.svg" alt="화살표" width="16" height="16">
                            </div>
                            <div class="card-content">
                                <div class="stat-row">
                                    <span class="stat-label">전체</span>
                                    <span class="stat-value">26,548</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <div class="content-area">

                    <!-- Main Content -->
                    <main class="main-content">
                        <div class="page-header">
                            <div class="header-back">
                                <img src="icon/icon-arrowleft.svg" alt="뒤로가기" width="32" height="32">
                            </div>
                            <h1>링크 블록</h1>
                        </div>

                        <div class="content-container">
                            <!-- 링크 블록 설정 컨테이너 -->
                            <div class="link-block-container">
                                <!-- 카드 미리보기 영역 -->
                                <div class="card-preview-section">
                                    <div class="preview-background">
                                        <!-- 링크 블록 스티커 미리보기 -->
                                        <div class="sticker-preview-wrapper">
                                            <div class="link-block sticker">
                                                <div class="block-img"></div>
                                                <div class="block-content">
                                                    <div class="preview-text">
                                                        <p>타이틀을 입력해주세요</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 스타일 선택 -->
                                    <div class="style-selection">
                                        <div class="style-options">
                                            <div class="style-option active" onclick="selectStyleOption(this, 'thumbnail')">
                                                <div class="style-card selected">
                                                    <img src="resource/linkblock-img.png" alt="썸네일 스타일" width="59" height="27">
                                                </div>
                                                <span class="style-label active">썸네일</span>
                                            </div>
                                            <div class="style-option" onclick="selectStyleOption(this, 'simple')">
                                                <div class="style-card">
                                                    <img src="resource/image=simple.png" alt="심플 스타일" width="59" height="27">
                                                </div>
                                                <span class="style-label">심플</span>
                                            </div>
                                            <div class="style-option" onclick="selectStyleOption(this, 'card')">
                                                <div class="style-card">
                                                    <img src="resource/image=card.png" alt="카드 스타일" width="59" height="27">
                                                </div>
                                                <span class="style-label">카드</span>
                                            </div>
                                            <div class="style-option" onclick="selectStyleOption(this, 'background')">
                                                <div class="style-card">
                                                    <img src="resource/image=background.png" alt="배경 스타일" width="59" height="27">
                                                </div>
                                                <span class="style-label">배경</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 입력 필드들 -->
                                    <div class="input-group">
                                        <label class="input-label">타이틀</label>
                                        <div class="input-field">
                                            <input type="text" placeholder="타이틀을 입력해주세요" value="" oninput="updatePreviewText(this.value)">
                                                <img class="clear-btn" src="icon/icon-clear.svg" alt="지우기" width="24" height="24" onclick="clearInput(this)">
                                        </div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="input-label">링크 주소</label>
                                        <div class="input-field">
                                            <input type="text" placeholder="링크를 입력해주세요" value="" oninput="updateInputFieldState(this); updateSaveButtonState()">
                                            <img class="clear-btn" src="icon/icon-clear.svg" alt="지우기" width="24" height="24" onclick="clearInput(this)">
                                        </div>
                                    </div>

                                    <!-- 이미지 섹션 -->
                                    <div class="image-section">
                                        <label class="input-label">이미지</label>
                                        <div class="image-upload-area">
                                            <img src="icon/icon-plus.svg" alt="이미지 추가" width="24" height="24">
                                        </div>
                                    </div>
                                </div>

                                <!-- 링크 공개 여부 -->
                                <div class="link-visibility-section">
                                    <div class="section-header">
                                        <span class="section-title">링크 공개 여부</span>
                                        <button class="section-toggle active" onclick="toggleAccordion(this)">
                                            <img src="resource/button-toggle-on.svg" alt="접기">
                                        </button>
                                    </div>
                                    
                                    <div class="section-content">
                                        <div class="radio-options">
                                            <div class="radio-option active" onclick="selectRadioOption(this, 'immediate')">
                                                <div class="radio-button selected">
                                                    <img src="icon/icon-radio-selected.svg" alt="선택됨" width="24" height="24">
                                                </div>
                                                <span>바로 공개</span>
                                            </div>
                                            <div class="radio-option" onclick="selectRadioOption(this, 'scheduled')">
                                                <div class="radio-button">
                                                    <img src="icon/icon-radio-default.svg" alt="선택안됨" width="24" height="24">
                                                </div>
                                                <div class="section-title-group">
                                                <span>예약 설정</span>
                                                    <span class="badge-label">PRO</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>

                                <!-- 스티커 설정 -->
                                <div class="sticker-section">
                                    <div class="section-header">
                                        <div class="section-title-group">
                                            <span class="section-title">스티커로 꾸미기</span>
                                            <span class="badge-label">PRO</span>
                                        </div>
                                        <button class="section-toggle" onclick="toggleAccordion(this)">
                                            <img src="resource/button-toggle-off.svg" alt="펼치기">
                                        </button>
                                    </div>
                                    
                                    <div class="section-content" style="display: none;">
                                        <!-- 스티커 추가/삭제 -->
                                        <div class="sticker-management">
                                            <div class="sticker-items" id="sticker-items-container">
                                                <div class="sticker-item" data-sticker-id="1" data-background-color="#ffffff" data-text-color="#000000" data-shape="shape1">
                                                    <div class="sticker-preview-item selected" onclick="selectSticker(this)">
                                                        <div class="sticker-badge" style="background-color: #ffffff; color: #000000; border: 1px solid #d1d5db;">
                                                            <span>꾸며봐요</span>
                                                        </div>
                                                        <img class="remove-btn" src="icon/icon-remove.svg" alt="삭제" width="24" height="24" onclick="removeSticker(this, event)">
                                                    </div>
                                                </div>
                                                <button class="add-sticker-btn" onclick="addSticker()">
                                                        <img src="icon/icon-plus.svg" alt="추가" width="24" height="24">
                                                    </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 내용 입력 -->
                                        <div class="content-input">
                                            <label class="input-label">내용 입력</label>
                                            <div class="input-field">
                                                <input type="text" placeholder="sticker" value="꾸며봐요" oninput="updateStickerBadge(this.value); updateInputFieldState(this);">
                                                <img class="clear-btn" src="icon/icon-clear.svg" alt="지우기" width="24" height="24" onclick="clearInput(this)">
                                            </div>
                                        </div>
                                        
                                        <!-- 스티커 모양 -->
                                        <div class="sticker-shape">
                                            <label class="input-label">스티커 모양</label>
                                            <div class="shape-options">
                                                <button class="shape-option active" onclick="selectShapeOption(this, 'shape1')">
                                                        <img src="resource/image=shape1.png" alt="모양 1" width="60" height="32">
                                                </button>
                                                <button class="shape-option" onclick="selectShapeOption(this, 'shape2')">
                                                        <img src="resource/image=shape2.png" alt="모양 2" width="60" height="32">
                                                </button>
                                                <button class="shape-option" onclick="selectShapeOption(this, 'shape3')">
                                                        <img src="resource/image=shape3.png" alt="모양 3" width="60" height="32">
                                                </button>
                                                <button class="shape-option" onclick="selectShapeOption(this, 'shape4')">
                                                        <img src="resource/image=shape4.png" alt="모양 4" width="60" height="32">
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 텍스트 색상 -->
                                        <div class="color-picker">
                                            <label class="input-label">텍스트 색상</label>
                                            <div class="text-color-options">
                                                <button class="text-color-option" onclick="selectTextColor(this, 'custom')">
                                                    <div class="color-circle">
                                                        <img src="icon/icon-color.svg" alt="색상 선택" width="24" height="24">
                                                    </div>
                                                </button>
                                                <button class="text-color-option" onclick="selectTextColor(this, '#ffffff')">
                                                    <div class="color-circle white"></div>
                                                </button>
                                                <button class="text-color-option selected" onclick="selectTextColor(this, '#000000')">
                                                    <div class="color-circle black"></div>
                                                </button>
                                                <button class="text-color-option" onclick="selectTextColor(this, '#ec5aa1')">
                                                    <div class="color-circle pink"></div>
                                                </button>
                                                <button class="text-color-option" onclick="selectTextColor(this, '#ee7477')">
                                                    <div class="color-circle red"></div>
                                                </button>
                                                <button class="text-color-option" onclick="selectTextColor(this, '#f4c05f')">
                                                    <div class="color-circle orange"></div>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 배경 색상 -->
                                        <div class="color-picker">
                                            <label class="input-label">배경 색상</label>
                                            <div class="background-color-options">
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, 'custom')">
                                                    <div class="color-circle">
                                                        <img src="icon/icon-color.svg" alt="색상 선택" width="24" height="24">
                                                    </div>
                                                </button>
                                                <button class="background-color-option selected" onclick="selectBackgroundColor(this, '#ffffff')">
                                                    <div class="color-circle white"></div>
                                                </button>
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, '#000000')">
                                                    <div class="color-circle black"></div>
                                                </button>
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, '#84fac1')">
                                                    <div class="color-circle green"></div>
                                                </button>
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, '#6abef6')">
                                                    <div class="color-circle blue"></div>
                                                </button>
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, '#a874f9')">
                                                    <div class="color-circle purple"></div>
                                                </button>
                                                <button class="background-color-option" onclick="selectBackgroundColor(this, '#ca56eb')">
                                                    <div class="color-circle violet"></div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 저장 버튼 -->
                                <button class="save-btn" id="save-btn" disabled>
                                    <span>저장하기</span>
                                </button>
                            </div>

                            <!-- 미리보기 사이드바 -->
                            <div class="preview-sidebar">
                                <!-- 링크 URL -->
                                <div class="link-url-card">
                                    <div class="url-content">
                                        <span>https://link.inpock.co.kr/</span>
                                        <span>ninashop</span>
                                    </div>
                                    <img src="icon/icon-share.svg" alt="공유" width="24" height="24">
                                </div>
                                
                                <!-- 모바일 미리보기 -->
                                <div class="mobile-preview">
                                    <div class="preview-phone">
                                        <div class="phone-content">
                                            <!-- 프로필 영역 -->
                                            <div class="profile-section">
                                                <div class="profile-avatar">
                                                    <img src="resource/profile.png" alt="프로필" width="86" height="86">
                                                </div>
                                                <div class="profile-info">
                                                    <h2>ninashop</h2>
                                                    <p>감성있는 상품을 소개합니다:-)</p>
                                                </div>
                                                <div class="business-badge">
                                                    <img src="icon/icon-mail.svg" alt="메일" width="20" height="20">
                                                    <span>비즈니스 제안</span>
                                                </div>
                                            </div>
                                            
                                            <!-- 링크 블록들 -->
                                            <div class="link-blocks">
                                                <div class="link-block sticker">
                                                    <div class="block-img"></div>
                                                    <div class="block-content">
                                                        <div class="preview-text">
                                                            <p>타이틀을 입력해주세요</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="link-block">
                                                    <div class="block-img" style="background-image: url('resource/thumb-1.png');"></div>
                                                    <div class="block-text">
                                                        <p>2차 공구!! 보부상도 사용하는 니나백</p>
                                                    </div>
                                                </div>
                                                <div class="link-block">
                                                    <div class="block-img" style="background-image: url('resource/thumb-2.png');"></div>
                                                    <div class="block-text">
                                                        <p>나만의 걱정 인형 만들기, 우드볼</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 공유/알림 버튼 -->
                                        <button class="share-btn">
                                            <img src="icon/icon-share.svg" alt="공유" width="24" height="24">
                                        </button>
                                        <button class="notice-btn">
                                            <img src="icon/icon-notice.svg" alt="알림" width="24" height="24">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation (모바일에서만 표시) -->
    <nav class="mobile-bottom-nav">
        <a href="link-page.html" class="mobile-nav-item active" onclick="window.location.href='link-page.html'; return false;">
            <div class="nav-icon">
                <img src="icon/icon-gnb-link-active.svg" alt="링크" width="24" height="24">
            </div>
            <span>링크</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <div class="nav-icon">
                <img src="icon/icon-gnb-manager.svg" alt="매니저" width="24" height="24">
            </div>
            <span>매니저</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <div class="nav-icon">
                <img src="icon/icon-gnb-deal.svg" alt="딜" width="24" height="24">
            </div>
            <span>딜</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <div class="nav-icon">
                <img src="icon/icon-gnb-chat.svg" alt="채팅" width="24" height="24">
            </div>
            <span>채팅</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <div class="nav-icon">
                <img src="icon/icon-gnb-all.svg" alt="전체" width="24" height="24">
            </div>
            <span>전체</span>
        </a>
    </nav>
    
    <script>
        // 라디오 옵션 선택 함수
        function selectRadioOption(element, value) {
            // 모든 라디오 옵션에서 active와 selected 클래스 제거
            const allOptions = document.querySelectorAll('.radio-option');
            allOptions.forEach(option => {
                option.classList.remove('active');
                const radioButton = option.querySelector('.radio-button');
                radioButton.classList.remove('selected');
                const img = radioButton.querySelector('img');
                img.src = 'icon/icon-radio-default.svg';
            });
            
            // 클릭된 옵션에 active와 selected 클래스 추가
            element.classList.add('active');
            const radioButton = element.querySelector('.radio-button');
            radioButton.classList.add('selected');
            const img = radioButton.querySelector('img');
            img.src = 'icon/icon-radio-selected.svg';
            
            // 선택된 값에 따른 추가 로직 (필요시)
            console.log('Selected option:', value);
        }

        // 바로 공개로 기본값 리셋 함수
        function resetToImmediatePublish() {
            // 모든 라디오 옵션에서 active와 selected 클래스 제거
            const allOptions = document.querySelectorAll('.radio-option');
            allOptions.forEach(option => {
                option.classList.remove('active');
                const radioButton = option.querySelector('.radio-button');
                radioButton.classList.remove('selected');
                const img = radioButton.querySelector('img');
                img.src = 'icon/icon-radio-default.svg';
            });
            
            // 바로 공개 옵션을 찾아서 선택
            const immediateOption = document.querySelector('.radio-option[onclick*="immediate"]');
            if (immediateOption) {
                immediateOption.classList.add('active');
                const radioButton = immediateOption.querySelector('.radio-button');
                radioButton.classList.add('selected');
                const img = radioButton.querySelector('img');
                img.src = 'icon/icon-radio-selected.svg';
                console.log('Reset to immediate publish');
            }
        }

        // 스타일 옵션 선택 함수
        function selectStyleOption(element, styleType) {
            // 모든 style-option에서 active와 selected 클래스 제거
            const allStyleOptions = document.querySelectorAll('.style-option');
            allStyleOptions.forEach(option => {
                option.classList.remove('active');
                const styleCard = option.querySelector('.style-card');
                const styleLabel = option.querySelector('.style-label');
                styleCard.classList.remove('selected');
                styleLabel.classList.remove('active');
            });
            
            // 클릭된 옵션에 active와 selected 클래스 추가
            element.classList.add('active');
            const styleCard = element.querySelector('.style-card');
            const styleLabel = element.querySelector('.style-label');
            styleCard.classList.add('selected');
            styleLabel.classList.add('active');
            
            // 스타일별 요소 표시/숨김 처리
            const linkBlockSticker = document.querySelector('.link-block.sticker .block-img');
            const imageSection = document.querySelector('.image-section');
            
            if (styleType === 'thumbnail') {
                // 썸네일 선택 시: block-img와 image-section 표시
                if (linkBlockSticker) {
                    linkBlockSticker.style.display = 'block';
                }
                if (imageSection) {
                    imageSection.style.display = 'block';
                }
            } else if (styleType === 'simple') {
                // 심플 선택 시: block-img와 image-section 숨김
                if (linkBlockSticker) {
                    linkBlockSticker.style.display = 'none';
                }
                if (imageSection) {
                    imageSection.style.display = 'none';
                }
            } else {
                // 다른 스타일 선택 시: 기본적으로 표시
                if (linkBlockSticker) {
                    linkBlockSticker.style.display = 'block';
                }
                if (imageSection) {
                    imageSection.style.display = 'block';
                }
            }
            
            // 선택된 스타일에 따른 추가 로직 (필요시)
            console.log('Selected style:', styleType);
        }

        // 스티커 모양 선택 함수
        function selectShapeOption(element, shapeType) {
            // 모든 shape-option에서 active 클래스 제거
            const allShapeOptions = document.querySelectorAll('.shape-option');
            allShapeOptions.forEach(option => {
                option.classList.remove('active');
            });
            
            // 클릭된 옵션에 active 클래스 추가
            element.classList.add('active');
            
            // 현재 선택된 스티커의 모양만 변경
            const selectedSticker = document.querySelector('.sticker-preview-item.selected');
            if (selectedSticker) {
                const stickerItem = selectedSticker.closest('.sticker-item');
                const badge = selectedSticker.querySelector('.sticker-badge');
                
                // 선택된 스티커의 data-shape 속성 업데이트
                stickerItem.setAttribute('data-shape', shapeType);
                
                // 선택된 스티커의 border-radius만 변경
                if (shapeType === 'shape1') {
                    badge.style.borderRadius = 'var(--radius-500)';
                } else if (shapeType === 'shape2') {
                    badge.style.borderRadius = 'var(--radius-100)';
                } else if (shapeType === 'shape3') {
                    badge.style.borderRadius = 'var(--radius-100)';
                } else if (shapeType === 'shape4') {
                    badge.style.borderRadius = 'var(--radius-100)';
                }
            }
            
            // 미리보기 스티커들도 업데이트
            updatePreviewStickers();
            
            console.log('Selected shape:', shapeType);
        }

        // 아코디언 토글 함수 (HTML에 직접 추가)
        function toggleAccordion(button) {
            console.log('Accordion clicked!');
            const section = button.closest('.link-visibility-section, .sticker-section');
            const content = section.querySelector('.section-content');
            const arrow = button.querySelector('img');
            
            // 토글 상태 변경
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                // 펼치기 - section-content 표시
                content.style.display = 'flex';
                arrow.src = 'resource/button-toggle-on.svg';
                arrow.alt = '접기';
                console.log('Expanded');
                
                // 스티커 섹션이면 미리보기 스티커 표시
                if (section.classList.contains('sticker-section')) {
                    updatePreviewStickers();
                }
            } else {
                // 접기 - section-content 숨기기
                content.style.display = 'none';
                arrow.src = 'resource/button-toggle-off.svg';
                arrow.alt = '펼치기';
                console.log('Collapsed');
                
                // 스티커 섹션이면 미리보기 스티커 숨기기
                if (section.classList.contains('sticker-section')) {
                    hidePreviewStickers();
                }
                
                // 링크 공개여부 섹션이면 바로 공개로 기본값 설정
                if (section.classList.contains('link-visibility-section')) {
                    resetToImmediatePublish();
                }
            }
        }

        // 입력 필드 초기화 함수
        function clearInput(button) {
            const inputField = button.closest('.input-field');
            const input = inputField.querySelector('input');
            
            // input value 초기화
            input.value = '';
            
            // 타이틀 input인 경우 preview text도 초기화
            if (input.placeholder === '타이틀을 입력해주세요') {
                const previewText = document.querySelector('.preview-text p');
                if (previewText) {
                    previewText.textContent = '';
                }
            }
            
            // 스티커 input인 경우 sticker badge도 초기화
            if (input.placeholder === 'sticker') {
                updateStickerBadge('');
            }
            
            // 인풋 필드 상태 업데이트
            updateInputFieldState(input);
            
            // 저장 버튼 상태 업데이트
            updateSaveButtonState();
            
            console.log('Input cleared');
        }

        // 실시간 텍스트 반영 함수 (HTML에 직접 추가)
        function updatePreviewText(value) {
            // 모든 preview-text-area의 텍스트 업데이트
            const previewTextAreas = document.querySelectorAll('.preview-text-area p');
            previewTextAreas.forEach(area => {
                // 빈 값이면 기본값 표시, 아니면 입력된 값 표시
                area.textContent = value.trim() === '' ? '타이틀을 입력해주세요' : value;
            });
            
            // 기존 preview-text도 업데이트 (호환성 유지)
            const previewText = document.querySelector('.preview-text p');
            if (previewText) {
                // 빈 값이면 기본값 표시, 아니면 입력된 값 표시
                previewText.textContent = value.trim() === '' ? '타이틀을 입력해주세요' : value;
            }
            
            // 인풋 필드 상태 업데이트
            updateInputFieldState(event.target);
            
            // 저장 버튼 상태 업데이트
            updateSaveButtonState();
            
                console.log('Preview text updated:', value);
        }

        // 인풋 필드 상태 업데이트 함수
        function updateInputFieldState(inputElement) {
            const inputField = inputElement.closest('.input-field');
            if (inputField) {
                const value = inputElement.value.trim();
                if (value !== '') {
                    inputField.classList.add('inputed');
                } else {
                    inputField.classList.remove('inputed');
                }
            }
        }

        // 저장 버튼 상태 업데이트 함수
        function updateSaveButtonState() {
            const titleInput = document.querySelector('input[placeholder="타이틀을 입력해주세요"]');
            const linkInput = document.querySelector('input[placeholder="링크를 입력해주세요"]');
            const saveBtn = document.getElementById('save-btn');
            
            if (titleInput && linkInput && saveBtn) {
                const titleValue = titleInput.value.trim();
                const linkValue = linkInput.value.trim();
                
                // 둘 다 값이 있어야 활성화, 하나라도 비어있으면 비활성화
                if (titleValue !== '' && linkValue !== '') {
                    saveBtn.disabled = false;
                } else {
                    saveBtn.disabled = true;
                }
            }
        }

        // 스티커 인풋필드 동기화 함수
        function updateStickerBadge(value) {
            const selectedSticker = document.querySelector('.sticker-preview-item.selected');
            if (selectedSticker) {
                const badge = selectedSticker.querySelector('.sticker-badge span');
                if (badge) {
                    badge.textContent = value || '꾸며봐요';
                }
                
                // 미리보기 영역의 해당 스티커도 업데이트
                updatePreviewStickers();
            }
            console.log('Selected sticker badge updated:', value || '꾸며봐요');
        }

        // 스티커 컨테이너 생성 헬퍼 (현재 스티커 상태를 기반으로 컨테이너 하나를 만들어 반환)
        function buildStickerBadgesContainer() {
            const container = document.createElement('div');
            container.className = 'sticker-badges-container';
            const stickerItems = document.querySelectorAll('.sticker-item');
            stickerItems.forEach(item => {
                const badge = item.querySelector('.sticker-badge');
                if (!badge) return;
                const span = badge.querySelector('span');
                const text = span ? span.textContent : '꾸며봐요';
                const backgroundColor = badge.style.backgroundColor || '#ffffff';
                const color = span && span.style.color ? span.style.color : '#000000';
                const border = badge.style.border || '1px solid var(--color-gray-300)';
                const shapeType = item.getAttribute('data-shape') || 'shape1';
                let borderRadius = 'var(--radius-500)';
                if (shapeType === 'shape2' || shapeType === 'shape3' || shapeType === 'shape4') {
                    borderRadius = 'var(--radius-100)';
                }
                const sticker = document.createElement('div');
                sticker.className = 'sticker-badge';
                sticker.style.backgroundColor = backgroundColor;
                sticker.style.color = color;
                sticker.style.border = border;
                sticker.style.borderRadius = borderRadius;
                sticker.innerHTML = `<span>${text}</span>`;
                container.appendChild(sticker);
            });
            return container;
        }

        // 미리보기 영역의 스티커들 업데이트
        function updatePreviewStickers() {
            const linkBlockContents = document.querySelectorAll('.link-block.sticker .block-content');

            // 기존 컨테이너 제거
            linkBlockContents.forEach(bc => {
                const prev = bc.querySelector('.sticker-badges-container');
                if (prev) prev.remove();
            });

            // 새 컨테이너 부착
            linkBlockContents.forEach(bc => {
                bc.appendChild(buildStickerBadgesContainer());
            });
        }

        // 미리보기 스티커 숨기기 함수
        function hidePreviewStickers() {
            const linkBlockContents = document.querySelectorAll('.link-block.sticker .block-content');

            linkBlockContents.forEach(bc => {
                const c = bc.querySelector('.sticker-badges-container');
                if (c) c.remove();
            });
        }

        // 스티커 선택 함수
        function selectSticker(element) {
            // 모든 스티커에서 selected 클래스 제거
            const allStickers = document.querySelectorAll('.sticker-preview-item');
            allStickers.forEach(sticker => {
                sticker.classList.remove('selected');
            });
            
            // 선택된 스티커에 selected 클래스 추가
            element.classList.add('selected');
            
            // 선택된 스티커의 텍스트를 입력 필드에 반영
            const badgeText = element.querySelector('.sticker-badge span').textContent;
            const stickerInput = document.querySelector('.sticker-section input[type="text"]');
            if (stickerInput) {
                stickerInput.value = badgeText;
            }
            
            // 선택된 스티커의 색상에 맞게 컬러 옵션 동기화
            syncColorOptions(element);
            
            // 선택된 스티커의 모양에 맞게 shape 옵션 동기화
            syncShapeOptions(element);
            
            console.log('Sticker selected:', badgeText);
        }

        // 모양 옵션 동기화 함수
        function syncShapeOptions(stickerElement) {
            const stickerItem = stickerElement.closest('.sticker-item');
            const shapeType = stickerItem.getAttribute('data-shape') || 'shape1';
            
            // 모든 shape-option에서 active 클래스 제거
            const allShapeOptions = document.querySelectorAll('.shape-option');
            allShapeOptions.forEach(option => {
                option.classList.remove('active');
            });
            
            // 해당 모양의 shape-option에 active 클래스 추가
            const targetShapeOption = document.querySelector(`.shape-option[onclick*="${shapeType}"]`);
            if (targetShapeOption) {
                targetShapeOption.classList.add('active');
            }
        }

        // 컬러 옵션 동기화 함수
        function syncColorOptions(stickerElement) {
            const stickerItem = stickerElement.closest('.sticker-item');
            if (!stickerItem) return;
            
            // 데이터 속성에서 색상 정보 가져오기
            const backgroundColor = stickerItem.getAttribute('data-background-color');
            const textColor = stickerItem.getAttribute('data-text-color');
            
            console.log('=== SYNC COLORS ===');
            console.log('Sticker background:', backgroundColor);
            console.log('Sticker text:', textColor);
            
            // 모든 컬러 옵션에서 selected 클래스 제거
            document.querySelectorAll('.text-color-option, .background-color-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // 텍스트 색상 매칭
            if (textColor) {
                const textColorOptions = document.querySelectorAll('.text-color-option');
                textColorOptions.forEach((option, index) => {
                    const onclickAttr = option.getAttribute('onclick');
                    if (onclickAttr) {
                        const colorMatch = onclickAttr.match(/'([^']+)'/);
                        if (colorMatch && colorMatch[1] !== 'custom') {
                            const optionColor = colorMatch[1].toLowerCase();
                            console.log(`Text option ${index}: ${optionColor} vs ${textColor.toLowerCase()} = ${optionColor === textColor.toLowerCase()}`);
                            if (optionColor === textColor.toLowerCase()) {
                                option.classList.add('selected');
                                console.log(`Text option ${index} SELECTED!`);
                            }
                        }
                    }
                });
            }
            
            // 배경 색상 매칭
            if (backgroundColor) {
                const backgroundColorOptions = document.querySelectorAll('.background-color-option');
                backgroundColorOptions.forEach((option, index) => {
                    const onclickAttr = option.getAttribute('onclick');
                    if (onclickAttr) {
                        const colorMatch = onclickAttr.match(/'([^']+)'/);
                        if (colorMatch && colorMatch[1] !== 'custom') {
                            const optionColor = colorMatch[1].toLowerCase();
                            console.log(`Background option ${index}: ${optionColor} vs ${backgroundColor.toLowerCase()} = ${optionColor === backgroundColor.toLowerCase()}`);
                            if (optionColor === backgroundColor.toLowerCase()) {
                                option.classList.add('selected');
                                console.log(`Background option ${index} SELECTED!`);
                            }
                        }
                    }
                });
            }
            
            console.log('=== END SYNC ===');
        }

        // 색상 매칭 함수
        function colorsMatch(color1, color2) {
            if (!color1 || !color2) return false;
            
            // 색상을 정규화하여 비교
            const normalizeColor = (color) => {
                if (!color) return '';
                
                // rgb(r, g, b) 형태를 #rrggbb로 변환
                if (color.startsWith('rgb')) {
                    const match = color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                    if (match) {
                        const r = parseInt(match[1]).toString(16).padStart(2, '0');
                        const g = parseInt(match[2]).toString(16).padStart(2, '0');
                        const b = parseInt(match[3]).toString(16).padStart(2, '0');
                        return `#${r}${g}${b}`;
                    }
                }
                
                // 이미 hex 형태인 경우
                if (color.startsWith('#')) {
                    return color.toLowerCase();
                }
                
                return color.toLowerCase();
            };
            
            const norm1 = normalizeColor(color1);
            const norm2 = normalizeColor(color2);
            
            return norm1 === norm2;
        }

        // 스티커 추가 함수
        function addSticker() {
            const container = document.getElementById('sticker-items-container');
            const existingStickers = container.querySelectorAll('.sticker-item');
            
            // 최대 3개 제한
            if (existingStickers.length >= 3) {
                alert('스티커는 최대 3개까지 생성할 수 있습니다.');
                return;
            }
            
            const newId = existingStickers.length + 1;
            
            // 새로운 스티커 아이템 생성
            const newStickerItem = document.createElement('div');
            newStickerItem.className = 'sticker-item';
            newStickerItem.setAttribute('data-sticker-id', newId);
            
            newStickerItem.innerHTML = `
                <div class="sticker-preview-item" onclick="selectSticker(this)">
                    <div class="sticker-badge" style="background-color: #ffffff; color: #000000; border: 1px solid #d1d5db;">
                        <span>꾸며봐요</span>
                    </div>
                    <img class="remove-btn" src="icon/icon-remove.svg" alt="삭제" width="24" height="24" onclick="removeSticker(this, event)">
                </div>
            `;
            
            // 새 스티커에 기본 색상 및 모양 데이터 속성 설정
            newStickerItem.setAttribute('data-background-color', '#ffffff');
            newStickerItem.setAttribute('data-text-color', '#000000');
            newStickerItem.setAttribute('data-shape', 'shape1');
            
            // 추가 버튼 앞에 새로운 스티커 삽입
            const addButton = container.querySelector('.add-sticker-btn');
            container.insertBefore(newStickerItem, addButton);
            
            // 새로 추가된 스티커를 선택
            selectSticker(newStickerItem.querySelector('.sticker-preview-item'));
            
            // 미리보기 영역 업데이트
            updatePreviewStickers();
            
            // + 버튼 표시/숨김 업데이트
            updateAddButtonVisibility();
            
            console.log('New sticker added with ID:', newId);
        }

        // 스티커 삭제 함수
        function removeSticker(button, event) {
            event.stopPropagation(); // 이벤트 버블링 방지
            
            const stickerItem = button.closest('.sticker-item');
            const isSelected = stickerItem.querySelector('.sticker-preview-item').classList.contains('selected');
            
            // 스티커가 1개만 남아있으면 삭제하지 않음
            const allStickers = document.querySelectorAll('.sticker-item');
            if (allStickers.length <= 1) {
                alert('최소 1개의 스티커는 유지해야 합니다.');
                return;
            }
            
            // 선택된 스티커가 삭제되는 경우, 첫 번째 스티커를 선택
            if (isSelected) {
                const firstSticker = document.querySelector('.sticker-item:not([data-sticker-id="' + stickerItem.getAttribute('data-sticker-id') + '"]');
                if (firstSticker) {
                    selectSticker(firstSticker.querySelector('.sticker-preview-item'));
                }
            }
            
            stickerItem.remove();
            
            // 미리보기 영역 업데이트
            updatePreviewStickers();
            
            // + 버튼 표시/숨김 업데이트
            updateAddButtonVisibility();
            
            console.log('Sticker removed');
        }

        // + 버튼 표시/숨김 관리 함수
        function updateAddButtonVisibility() {
            const container = document.getElementById('sticker-items-container');
            const existingStickers = container.querySelectorAll('.sticker-item');
            const addButton = container.querySelector('.add-sticker-btn');
            
            if (existingStickers.length >= 3) {
                addButton.style.display = 'none';
            } else {
                addButton.style.display = 'flex';
            }
        }

        // 토글 스위치 함수
        function toggleSwitch(element) {
            element.classList.toggle('active');
            const toggleIcon = element.querySelector('.toggle-icon');
            
            if (element.classList.contains('active')) {
                toggleIcon.src = 'icon/icon-toggle-on.svg';
                toggleIcon.alt = '토글 켜짐';
            } else {
                toggleIcon.src = 'icon/icon-toggle-off.svg';
                toggleIcon.alt = '토글 꺼짐';
            }
            
            console.log('Toggle switch clicked, active:', element.classList.contains('active'));
        }

        // 텍스트 색상 선택 함수
        function selectTextColor(button, color) {
            // 모든 텍스트 색상 옵션에서 selected 클래스 제거
            const textColorOptions = document.querySelectorAll('.text-color-option');
            textColorOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // 선택된 버튼에 selected 클래스 추가
            button.classList.add('selected');
            
            // 선택된 스티커의 텍스트 색상만 변경
            const selectedSticker = document.querySelector('.sticker-preview-item.selected');
            if (selectedSticker && color !== 'custom') {
                const badge = selectedSticker.querySelector('.sticker-badge span');
                if (badge) {
                    badge.style.color = color;
                }
                
                // 스티커 아이템에 색상 정보 저장
                const stickerItem = selectedSticker.closest('.sticker-item');
                if (stickerItem) {
                    stickerItem.setAttribute('data-text-color', color);
                }
                
                // 미리보기 영역의 해당 스티커도 업데이트
                updatePreviewStickers();
            }
            console.log('Text color changed to:', color);
        }

        // 배경 색상 선택 함수
        function selectBackgroundColor(button, color) {
            // 모든 배경 색상 옵션에서 selected 클래스 제거
            const backgroundColorOptions = document.querySelectorAll('.background-color-option');
            backgroundColorOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // 선택된 버튼에 selected 클래스 추가
            button.classList.add('selected');
            
            // 선택된 스티커의 배경 색상만 변경
            const selectedSticker = document.querySelector('.sticker-preview-item.selected');
            if (selectedSticker && color !== 'custom') {
                const badge = selectedSticker.querySelector('.sticker-badge');
                if (badge) {
                    badge.style.backgroundColor = color;
                    // 흰색일 때만 그레이300 보더, 다른 색상일 때는 배경색과 동일한 보더
                    if (color === '#ffffff') {
                        badge.style.border = '1px solid var(--color-gray-300)';
                    } else {
                        badge.style.border = `1px solid ${color}`;
                    }
                }
                
                // 스티커 아이템에 색상 정보 저장
                const stickerItem = selectedSticker.closest('.sticker-item');
                if (stickerItem) {
                    stickerItem.setAttribute('data-background-color', color);
                }
                
                // 미리보기 영역의 해당 스티커도 업데이트
                updatePreviewStickers();
            }
            console.log('Background color changed to:', color);
        }

        // 페이지 로드 시 초기값 동기화
        document.addEventListener('DOMContentLoaded', function() {
            const titleInput = document.querySelector('input[placeholder="타이틀을 입력해주세요"]');
            
            if (titleInput) {
                // 초기값 동기화 (빈 값으로 시작하지만 기본값 표시)
                updatePreviewText(titleInput.value);
                console.log('Initial value synchronized:', titleInput.value || 'empty');
            }
            
            // 초기 인풋 필드 상태 설정
            const allInputs = document.querySelectorAll('.input-field input');
            allInputs.forEach(input => {
                updateInputFieldState(input);
            });
            
            // 초기 저장 버튼 상태 설정
            updateSaveButtonState();
            
            // 스티커 인풋필드 이벤트 리스너 추가
            const stickerInput = document.querySelector('.sticker-section input[type="text"]');
            if (stickerInput) {
                // 초기값 동기화
                updateStickerBadge(stickerInput.value);
                
                // 초기 인풋 필드 상태 설정
                updateInputFieldState(stickerInput);
                
                // 입력 이벤트 리스너
                stickerInput.addEventListener('input', function() {
                    updateStickerBadge(this.value);
                    updateInputFieldState(this);
                });
                
                console.log('Sticker input listener added');
            }
            
            // 스티커 섹션 초기 상태 설정 (접힘 상태)
            const stickerSection = document.querySelector('.sticker-section');
            if (stickerSection) {
                const toggleButton = stickerSection.querySelector('.section-toggle');
                const content = stickerSection.querySelector('.section-content');
                const arrow = toggleButton.querySelector('img');
                
                // 초기 상태: 접힘
                toggleButton.classList.remove('active');
                content.style.display = 'none';
                arrow.src = 'resource/button-toggle-off.svg';
                arrow.alt = '펼치기';
                
                // 우측 미리보기에서 스티커 숨기기
                hidePreviewStickers();
                
                console.log('Sticker section initialized as collapsed');
            }
            
            // 초기 색상 설정 (흰색 배경, 검은색 텍스트)
            const stickerBadges = document.querySelectorAll('.sticker-badge');
            if (stickerBadges.length > 0) {
                stickerBadges.forEach(badge => {
                    badge.style.backgroundColor = '#ffffff';
                    badge.style.border = '1px solid var(--color-gray-300)'; // 흰색 배경이므로 그레이300 보더
                    const span = badge.querySelector('span');
                    if (span) {
                        span.style.color = '#000000';
                    }
                });
                console.log('Initial colors applied: white background, black text');
            }
            
            // 초기 미리보기 스티커 설정 (스티커 섹션이 OFF이므로 호출하지 않음)
            
            // + 버튼 표시/숨김 초기화
            updateAddButtonVisibility();
            
            // 초기 스티커 선택 및 색상 동기화
            const initialSticker = document.querySelector('.sticker-preview-item.selected');
            if (initialSticker) {
                syncColorOptions(initialSticker);
            }
        });
    </script>
</body>
</html>